import{u as H,r as n,$ as J,b as N,j as e,t as I,S as K,B as b}from"./index-98278e05.js";import{M as V,T as W,a as X,P as Y,b as Z,u as ee}from"./leaflet-8994ba0f.js";import{u as se}from"./vendorApi-931e2668.js";import{U as F,h as M,D as h}from"./upload-78155ae1.js";import{F as o,R as v,C as f}from"./index-2f28a3c1.js";import{I as S}from"./index-f00ae2eb.js";import{S as ae}from"./index-9d1b7eeb.js";import{m as g}from"./index-f74f6955.js";import"./CheckOutlined-17eda048.js";async function oe(x,c){const d=`https://nominatim.openstreetmap.org/reverse?lat=${x}&lon=${c}&format=json`;try{const l=await fetch(d),j=await l.json();if(l.ok){const u=j.display_name;return console.log(`The place is: ${u}`),u}else return console.error(`Error fetching data: ${l.statusText}`),null}catch{return console.error("Error fetching data: "),null}}const ue=()=>{const x=H(),[c]=o.useForm(),[d,l]=n.useState([""]),[j,u]=n.useState(null),[P,U]=n.useState(),[k,w]=n.useState(null),[y,D]=n.useState();console.log(y),console.log(j),console.log(k);const O=[33.892166,9.561555499999997],[m,A]=n.useState(O),[E]=J(),i=N(s=>{var a;return(a=s.auth.user)==null?void 0:a.role.toLocaleUpperCase()}),q=N(s=>{var a,r;return(r=(a=s==null?void 0:s.auth)==null?void 0:a.user)==null?void 0:r.id});console.log(q),console.log(i);let p=[];if(i==="ADMIN"){const{data:s}=se();p=s==null?void 0:s.data.docs}console.log(i==="ADMIN"),console.log(p);const z=p==null?void 0:p.map(s=>({label:s.email,value:s.id})),[B,L]=n.useState(!1),T={center:m,zoom:6,style:{height:"400px",width:"100%"},attribution:"&copy; OpenStreetMap contributors"},_=({handleClick:s})=>(ee({click:s}),null),$=async s=>{const{lat:a,lng:r}=s.latlng,t=await oe(a,r);console.log(t),A([a,r,t]),L(!0)},R=()=>{l([...d,""])},Q=s=>{const a=[...d];a.splice(s,1),l(a)},G=async()=>{try{const a={...await c.validateFields(),positionOfShop:m};console.log(a),console.log(a.positionOfShop[2]);const r=a.positionOfShop[2];console.log(r);const t=await E({name:a.name,phoneNumber:a.phone,logo:P,location:a.positionOfShop.splice(0,2),address:r,socialMediaLinks:a.data,vendor_id:"a0986058-3833-4a2a-b898-6a4f582d379e",cover:y});console.log(t,"data of response"),"data"in t?(g.success("Product saved successfully!"),c.resetFields(),x("/stores")):"error"in t?(g.error("Failed to save product. Please try again."),console.error("Error saving product",t.error)):g.error("Unexpected response from server. Please try again later.")}catch(s){console.log(s),console.error("Error saving shop",s),g.error("Error saving shop")}},C=N(s=>{var a;return(a=s.auth.user)==null?void 0:a.email});return console.log(C),e.jsx("div",{className:"",children:e.jsxs("div",{className:"parent-container",children:[e.jsx("h1",{className:"title",children:"Add New Shop"}),e.jsx("div",{className:"create-shop-container",children:e.jsxs(o,{form:c,className:"form-shop",children:[e.jsx(v,{gutter:[22,0],className:"name-Shop",children:e.jsx(f,{span:24,children:e.jsx(o.Item,{name:"name",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop name"}],children:e.jsx(S,{size:"large",placeholder:"Name",className:"input-custom-small"})})})}),e.jsx(v,{gutter:[22,0],className:"name-shop",children:e.jsx(f,{span:24,children:e.jsx(o.Item,{name:"vendor",className:"select-vendor",style:{marginBottom:"20px"},children:e.jsx(ae,{size:"middle",placeholder:"select-vendor",className:"input-custom",options:i==="ADMIN"?z:[],defaultValue:i==="ADMIN"?void 0:C,disabled:i!=="ADMIN"})})})}),e.jsx(v,{gutter:[16,0],className:"number-Shop",children:e.jsx(f,{span:24,children:e.jsx(o.Item,{name:"phone",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop name"}],children:e.jsx(S,{size:"large",name:"phone",placeholder:"Shope Phone",className:"input-custom-small"})})})}),e.jsxs(V,{className:"map",...T,children:[e.jsx(W,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),B&&e.jsx(X,{position:m,children:e.jsxs(Y,{children:[e.jsxs("div",{children:["Latitude: ",m[0]]}),e.jsxs("div",{children:["Longitude: ",m[1]]})]})}),e.jsx(_,{handleClick:$})]}),e.jsx(o.Item,{className:"upload-images",name:"images",rules:[{required:!0,message:"Image is required!"}],children:e.jsxs(F.Dragger,{className:"drag-images",listType:"picture",accept:"image/*",multiple:!0,maxCount:1,onChange:s=>M(s,u,U),beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-text",children:"Drag & drop Shop image here"}),e.jsxs("div",{className:"icon-drag",children:[e.jsx(h,{className:"divider"}),e.jsx("p",{className:"or",children:"OR"}),e.jsx(h,{className:"divider"})]}),e.jsx(I,{className:"btn-select",children:"Select Files"}),e.jsx("p",{className:"size-img",children:"Upload 280*280 image"})]})}),e.jsxs(o.Item,{name:"dynamicInputs",children:[d.map((s,a)=>e.jsxs(K,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(o.Item,{name:["data",a],rules:[{required:!0,message:"Missing data"}],children:e.jsx(S,{className:"dynamic-input",placeholder:"Link"})}),e.jsx(Z,{onClick:()=>Q(a)})]},a)),e.jsx(o.Item,{children:e.jsx(b,{className:"add-btn",onClick:R,children:e.jsx("span",{children:"Add Link"})})})]}),e.jsx(o.Item,{className:"upload-images",name:"images",rules:[{required:!0,message:"Cover is required!"}],children:e.jsxs(F.Dragger,{className:"drag-images",listType:"picture",accept:"image/*",multiple:!0,maxCount:1,onChange:s=>M(s,w,D),beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-text",children:"Drag & drop Shop image here"}),e.jsxs("div",{className:"icon-drag",children:[e.jsx(h,{className:"divider"}),e.jsx("p",{className:"or",children:"OR"}),e.jsx(h,{className:"divider"})]}),e.jsx(I,{className:"btn-select",children:"Select Files"}),e.jsx("p",{className:"size-img",children:"Upload 280*280 image"})]})}),e.jsx(o.Item,{children:e.jsx(b,{type:"button",className:"add-cat",onClick:G,children:"Save Shop"})})]})})]})})};export{ue as default};
