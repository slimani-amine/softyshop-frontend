import{r as c,g as H,$ as K,a0 as W,b as C,j as e,q as X,S as Y,B as F}from"./index-043bdbd9.js";import{M as Z,T as ee,a as se,P as ae,b as te,u as oe}from"./leaflet-53d94262.js";import{S as ne}from"./Spinner-b2eac811.js";import{u as le}from"./vendorApi-0bac3c3e.js";import{U as re,h as ie,D as I}from"./upload-eadd2d27.js";import{F as o,R as j,C as S}from"./index-38fda43e.js";import{I as N}from"./index-10f1215d.js";import{S as ce}from"./index-08eb27d4.js";import{m as k}from"./index-8ba13c34.js";import"./CheckOutlined-95f96f6c.js";const fe=({onFinish:M,initialValues:P})=>{var b;const[O,E]=c.useState(null);console.log(O);const[f,U]=c.useState(),{id:h}=H(),[d]=o.useForm(),[w,L]=c.useState(!0),[p,g]=c.useState([]),{data:n,isLoading:D}=K(h==null?void 0:h.toString()),v=n==null?void 0:n.data;c.useEffect(()=>{if(n!=null&&n.data){const{name:s,phoneNumber:a,user:t,location:l,socialMediaLinks:i}=n.data,r=JSON.parse(l),G=JSON.parse(i);g(G),x([r[0],r[1],""]),d.setFieldsValue({name:s,phone:a,vendor:(t==null?void 0:t.email)||"a"})}},[P,d,n]);const[m,x]=c.useState([35,10,""]),B={center:m,zoom:6,style:{height:"400px",width:"100%"},attribution:"&copy; OpenStreetMap contributors"},z=({handleClick:s})=>{const a=oe({click:t=>{const{lat:l,lng:i}=t.latlng;s(l,i)}});return console.log(a),null},[A]=W(),$=async()=>{try{const a={...await d.validateFields(),positionOfShop:m,fields:p};console.log(a,"object Post");const t=await q(a.positionOfShop[0],a.positionOfShop[1]),i={name:a.name,phoneNumber:a.phone,logo:f,location:[a.positionOfShop[0],a.positionOfShop[1]],address:t,socialMediaLinks:a.data},r=await A({id:n.data.id,data:i});k.success("Shop updated successfully"),console.log(r),M()}catch(s){console.error("Error updating shop",s),k.error("Error updating shop")}};async function q(s,a){const t=`https://nominatim.openstreetmap.org/reverse?lat=${s}&lon=${a}&format=json`;try{const l=await fetch(t),i=await l.json();if(l.ok){const r=i.display_name;return console.log(`The place is: ${r}`),x([s,a,r]),r}else return console.error(`Error fetching data: ${l.statusText}`),null}catch{return console.error("Error fetching data: "),null}}const T=async(s,a)=>{x([s,a,""]),L(!0)},u=C(s=>{var a,t;return(t=(a=s==null?void 0:s.auth)==null?void 0:a.user)==null?void 0:t.role.toUpperCase()});let y=[];if(u==="ADMIN"){const{data:s}=le();y=((b=s==null?void 0:s.data)==null?void 0:b.docs)||[]}const R=y.map(s=>({label:s.email,value:s.id})),_=C(s=>{var a;return(a=s.auth.user)==null?void 0:a.email});if(D)return e.jsx(ne,{});const J=()=>{g([...p,""])},Q=s=>{const a=[...p];a.splice(s,1),g(a)};console.log(v);const V=[{uid:"-1",name:"Current Image",status:"done",url:f,thumbUrl:v.logo}];return e.jsx("div",{className:"",children:e.jsxs("div",{className:"parent-container",children:[e.jsx("h1",{className:"title",children:"Edit Shop"}),e.jsx("div",{className:"create-shop-container",children:e.jsxs(o,{form:d,className:"form-shop",children:[e.jsx(j,{gutter:[22,0],className:"name-Shop",children:e.jsx(S,{span:24,children:e.jsx(o.Item,{name:"name",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop name"}],children:e.jsx(N,{size:"large",placeholder:"Name",className:"input-custom-small"})})})}),e.jsx(j,{gutter:[16,0],className:"number-Shop",children:e.jsx(S,{span:24,children:e.jsx(o.Item,{name:"phone",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop phone"}],children:e.jsx(N,{size:"large",placeholder:"Shop Phone",className:"input-custom-small"})})})}),e.jsx(j,{gutter:[22,0],className:"name-shop",children:e.jsx(S,{span:24,children:e.jsx(o.Item,{name:"vendor",className:"select-vendor",style:{marginBottom:"20px"},rules:[{required:!0,message:"Please select a vendor"}],children:e.jsx(ce,{size:"middle",placeholder:"Select vendor",className:"input-custom",options:u==="ADMIN"?R:[],defaultValue:u==="ADMIN"?void 0:_,disabled:u!=="ADMIN"})})})}),e.jsxs(Z,{className:"map",...B,children:[e.jsx(ee,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),w&&e.jsx(se,{position:m,children:e.jsxs(ae,{children:[e.jsxs("div",{children:["Latitude: ",m[0]]}),e.jsxs("div",{children:["Longitude: ",m[1]]})]})}),e.jsx(z,{handleClick:T})]}),e.jsx(o.Item,{className:"upload-images",name:"images",children:e.jsxs(re.Dragger,{defaultFileList:V,className:"drag-images",listType:"picture",accept:"image/*",multiple:!0,maxCount:1,onChange:s=>ie(s,E,U),beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-text",children:"Drag & drop Shop image here"}),e.jsxs("div",{className:"icon-drag",children:[e.jsx(I,{className:"divider"}),e.jsx("p",{className:"or",children:"OR"}),e.jsx(I,{className:"divider"})]}),e.jsx(X,{className:"btn-select",children:"Select Files"}),e.jsx("p",{className:"size-img",children:"Upload 280*280 image"})]})}),e.jsxs(o.Item,{name:"dynamicInputs",children:[p.map((s,a)=>e.jsxs(Y,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(o.Item,{name:["data",a],rules:[{required:!0,message:"Missing data"}],initialValue:s,children:e.jsx(N,{className:"dynamic-input",placeholder:"Link"})}),e.jsx(te,{onClick:()=>Q(a)})]},a)),e.jsx(o.Item,{children:e.jsx(F,{className:"add-btn",onClick:J,children:e.jsx("span",{children:"Add Link"})})})]}),e.jsx(o.Item,{children:e.jsx(F,{type:"button",className:"add-cat",onClick:$,children:"Save Shop"})})]})})]})})};export{fe as default};
