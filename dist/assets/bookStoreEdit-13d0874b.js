import{u as K,r as c,g as W,a0 as X,a1 as Y,b as F,j as e,t as Z,S as ee,B as I}from"./index-98278e05.js";import{M as se,T as ae,a as te,P as oe,b as re,u as ne}from"./leaflet-8994ba0f.js";import{S as le}from"./Spinner-aa8e0f9e.js";import{u as ie}from"./vendorApi-931e2668.js";import{U as ce,h as de,D as P}from"./upload-78155ae1.js";import{F as r,R as S,C as N}from"./index-2f28a3c1.js";import{I as f}from"./index-f00ae2eb.js";import{S as me}from"./index-9d1b7eeb.js";import{m}from"./index-f74f6955.js";import"./CheckOutlined-17eda048.js";const ye=({onFinish:k,initialValues:M})=>{var C;const O=K(),[E,U]=c.useState(null);console.log(E);const[v,w]=c.useState(),{id:g}=W(),[p]=r.useForm(),[L,D]=c.useState(!0),[u,x]=c.useState([]),{data:n,isLoading:B}=X(g==null?void 0:g.toString()),y=n==null?void 0:n.data;c.useEffect(()=>{if(n!=null&&n.data){const{name:s,phoneNumber:a,user:t,location:l,socialMediaLinks:i}=n.data,o=JSON.parse(l),H=JSON.parse(i);x(H),j([o[0],o[1],""]),p.setFieldsValue({name:s,phone:a,vendor:(t==null?void 0:t.email)||"a"})}},[M,p,n]);const[d,j]=c.useState([35,10,""]),z={center:d,zoom:6,style:{height:"400px",width:"100%"},attribution:"&copy; OpenStreetMap contributors"},A=({handleClick:s})=>{const a=ne({click:t=>{const{lat:l,lng:i}=t.latlng;s(l,i)}});return console.log(a),null},[T]=Y(),$=async()=>{try{const a={...await p.validateFields(),positionOfShop:d,fields:u};console.log(a,"object Post");const t=await q(a.positionOfShop[0],a.positionOfShop[1]),i={name:a.name,phoneNumber:a.phone,logo:v,location:[a.positionOfShop[0],a.positionOfShop[1]],address:t,socialMediaLinks:a.data},o=await T({id:n.data.id,data:i});"data"in o?(m.success("Store updated successfully!"),console.log(o.data),O("/stores")):"error"in o?(m.error("Failed to save Store. Please try again."),console.error("Error saving Store",o.error)):m.error("Unexpected response from server. Please try again later."),m.success("Shop updated successfully"),console.log(o),k()}catch(s){console.error("Error updating shop",s),m.error("Error updating shop")}};async function q(s,a){const t=`https://nominatim.openstreetmap.org/reverse?lat=${s}&lon=${a}&format=json`;try{const l=await fetch(t),i=await l.json();if(l.ok){const o=i.display_name;return console.log(`The place is: ${o}`),j([s,a,o]),o}else return console.error(`Error fetching data: ${l.statusText}`),null}catch{return console.error("Error fetching data: "),null}}const R=async(s,a)=>{j([s,a,""]),D(!0)},h=F(s=>{var a,t;return(t=(a=s==null?void 0:s.auth)==null?void 0:a.user)==null?void 0:t.role.toUpperCase()});let b=[];if(h==="ADMIN"){const{data:s}=ie();b=((C=s==null?void 0:s.data)==null?void 0:C.docs)||[]}const _=b.map(s=>({label:s.email,value:s.id})),J=F(s=>{var a;return(a=s.auth.user)==null?void 0:a.email});if(B)return e.jsx(le,{});const Q=()=>{x([...u,""])},V=s=>{const a=[...u];a.splice(s,1),x(a)};console.log(y);const G=[{uid:"-1",name:"Current Image",status:"done",url:v,thumbUrl:y.logo}];return e.jsx("div",{className:"",children:e.jsxs("div",{className:"parent-container",children:[e.jsx("h1",{className:"title",children:"Edit Shop"}),e.jsx("div",{className:"create-shop-container",children:e.jsxs(r,{form:p,className:"form-shop",children:[e.jsx(S,{gutter:[22,0],className:"name-Shop",children:e.jsx(N,{span:24,children:e.jsx(r.Item,{name:"name",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop name"}],children:e.jsx(f,{size:"large",placeholder:"Name",className:"input-custom-small"})})})}),e.jsx(S,{gutter:[16,0],className:"number-Shop",children:e.jsx(N,{span:24,children:e.jsx(r.Item,{name:"phone",style:{marginBottom:0},rules:[{required:!0,message:"Please enter Shop phone"}],children:e.jsx(f,{size:"large",placeholder:"Shop Phone",className:"input-custom-small"})})})}),e.jsx(S,{gutter:[22,0],className:"name-shop",children:e.jsx(N,{span:24,children:e.jsx(r.Item,{name:"vendor",className:"select-vendor",style:{marginBottom:"20px"},rules:[{required:!0,message:"Please select a vendor"}],children:e.jsx(me,{size:"middle",placeholder:"Select vendor",className:"input-custom",options:h==="ADMIN"?_:[],defaultValue:h==="ADMIN"?void 0:J,disabled:h!=="ADMIN"})})})}),e.jsxs(se,{className:"map",...z,children:[e.jsx(ae,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),L&&e.jsx(te,{position:d,children:e.jsxs(oe,{children:[e.jsxs("div",{children:["Latitude: ",d[0]]}),e.jsxs("div",{children:["Longitude: ",d[1]]})]})}),e.jsx(A,{handleClick:R})]}),e.jsx(r.Item,{className:"upload-images",name:"images",children:e.jsxs(ce.Dragger,{defaultFileList:G,className:"drag-images",listType:"picture",accept:"image/*",multiple:!0,maxCount:1,onChange:s=>de(s,U,w),beforeUpload:()=>!1,children:[e.jsx("p",{className:"ant-upload-text",children:"Drag & drop Shop image here"}),e.jsxs("div",{className:"icon-drag",children:[e.jsx(P,{className:"divider"}),e.jsx("p",{className:"or",children:"OR"}),e.jsx(P,{className:"divider"})]}),e.jsx(Z,{className:"btn-select",children:"Select Files"}),e.jsx("p",{className:"size-img",children:"Upload 280*280 image"})]})}),e.jsxs(r.Item,{name:"dynamicInputs",children:[u.map((s,a)=>e.jsxs(ee,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(r.Item,{name:["data",a],rules:[{required:!0,message:"Missing data"}],initialValue:s,children:e.jsx(f,{className:"dynamic-input",placeholder:"Link"})}),e.jsx(re,{onClick:()=>V(a)})]},a)),e.jsx(r.Item,{children:e.jsx(I,{className:"add-btn",onClick:Q,children:e.jsx("span",{children:"Add Link"})})})]}),e.jsx(r.Item,{children:e.jsx(I,{type:"button",className:"add-cat",onClick:$,children:"Save Shop"})})]})})]})})};export{ye as default};
